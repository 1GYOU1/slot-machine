<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>규의 슬롯머신</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="wrap">
        <!-- 시작 화면 -->
        <div class="start_zone on">
            <h2 class="tit">프로필 만들기</h2>
            <div class="btn_area">
                <a class="custom_btn start_btn">게임 시작</a>
                <a class="custom_btn howto_btn">게임 방법</a>
            </div>
        </div>
        <!-- //시작 화면 -->
        <!-- 게임 화면 -->
        <div class="game_zone">
            <div class="round_1">
                <h3 class="tit">배경색</h3><!--배경색, 머리, 눈, 코, 입, 악세사리-->
                <ul class="slot_box">
                    <li><span></span></li>
                    <li><span></span></li>
                    <li><span></span></li>
                    <li><span></span></li>
                    <li><span></span></li>
                </ul>
            </div>  
            <div class="arrow_area">
                <span></span>
            </div>
            <div class="btn_area">
                <a href="javascript:void(0);" class="custom_btn">Stop</a>
            </div>
            <div class="preview">
                <div class="result_2"></div>
                <div class="result_3"></div>
                <div class="result_4"></div>
                <div class="result_5"></div>
            </div>
        </div>
        <!-- //게임 화면 -->
        <!-- 결과 화면 -->
        <div class="result_zone">
            
        </div>
        <!-- //결과 화면 -->
    </div>
    <div class="howto_pop">
        <div class="bg" onClick="popUpCloseEvent();"></div>
        <div class="cont">
            <a class="close" href="javascript:popUpCloseEvent();">
                <img src="./img/btn_cls_black.png" alt="">
            </a>
            게임 방법 팝업
            <br>어쩌구 저쩌구 입니다 !
            <br>블라블라.....
            <br>
            <br><span>※ 본 게임은 PC chrome 브라우저에 최적화 되어있습니다.</span>
        </div>
    </div>
    <script>
    /*
        1. 시작 화면 
            - start 버튼 클릭 시 게임 화면 진입 (✔)
            - 게임 방법 
                ㄴ 게임 방법 버튼 클릭 시 게임 방법 팝업 노출 (✔)
                ㄴ 팝업 배경 클릭 시 팝업 닫기 (✔)
                ㄴ 팝업 닫기 버튼 클릭 시 팝업 닫기 (✔)

        2. 게임 화면
            - 화살표 좌우로 움직이는 기능 (✔)

            - stop 버튼 클릭 이벤트
                ㄴ 화살표 멈추기 (✔)
                ㄴ class="round_1" roundCount++ 반영 (✔)

            - 멈춘 위치에 따른 선택 결과 값(percent 기준) 저장 (✔)

            - preview 영역에 저장한 선택 값 노출 ( )

            - 처음부터 다시 만들기 버튼 클릭 이벤트
                ㄴ 값 reset ( )

        3. 결과 화면
            - 결과 값에 따른 프로필 이미지 다운로드 기능 ( )
    */

    // start_zone
    const startZone = document.querySelector('.start_zone');
    const gameStartBtn = document.querySelector('.start_zone .start_btn'); // 게임 시작 버튼
    const howToBtn = document.querySelector('.start_zone .howto_btn'); // 게임 방법 버튼
    const howToPopUp = document.querySelector('.howto_pop');
    // game_zone
    const gameZone = document.querySelector('.game_zone');
    const arrowBox = document.querySelector('.arrow_area');// 화살표 박스
    const arrow = document.querySelector('.arrow_area span');// 화살표
    const stopArrowBtn = document.querySelector('.game_zone .custom_btn');// Stop 버튼

    let gameRound = document.querySelector('.game_zone .round_1');// round

    let priviewDiv = document.querySelectorAll('.game_zone .priview div');//

    let roundCount = 1;

    // 화살표 초기값
    let buttonAct = true;
    let Arrdirection = 'right';
    let persent = 0;
    let resultPersent = 0;// 화살표 결과 위치 값 (%)
    let arrMoveInterval;// 화살표 interval
    
    // 화살표 결과
    let resultArr = [];

    // 게임 시작
    gameStartBtn.addEventListener('click', function (){
        startZone.classList.remove('on');
        gameZone.classList.add('on');
        moveArr();
    });
    // 게임 방법 팝업 열기
    howToBtn.addEventListener('click', function (){
        howToPopUp.classList.add('on');
    });
    // 게임 방법 팝업 닫기
    function popUpCloseEvent(){
        howToPopUp.classList.remove('on');
    }

    function moveArr() {
        arrMoveInterval = setInterval(function(){
            let arrMovePosition = parseInt(arrowBox.getBoundingClientRect().width)*(persent*0.01);
            // 화살표 방향
            if(Arrdirection == 'right'){
                if(persent == 100){
                    Arrdirection = 'left';
                }else{
                    persent++;
                }
            }else{
                if(arrMovePosition <= 0){
                    Arrdirection = 'right';
                }else{
                    persent--;
                }
            }
            arrow.style.transform = `translateX(${arrMovePosition}px)`;
            resultPersent = persent;// 결과 위치 값 전달
        }, 1);
    }

    stopArrowBtn.addEventListener('click', function (){
        if(buttonAct){
            stopSlot();// 슬롯 멈추기
            // round_ 클래스 카운트 변경
            let currentClass = 'round_' + roundCount.toString();
            let currentRoundNumber = parseInt(currentClass.split('_')[1]);// 현재 라운드 번호 추출
            roundCount = currentRoundNumber + 1;// 다음 라운드 번호 계산 및 클래스 업데이트
            gameRound.classList.replace(currentClass, 'round_' + roundCount.toString())
        }else{
            reStartSlot();// 슬롯 다시 시작
        }
    })

    // 화살표 멈추기
    function stopSlot() {
        clearInterval(arrMoveInterval);
        buttonAct = false;
        // 결과 값 배열로 저장
        if(resultPersent < 20){
            resultArr.push(1);
        }else if(20 <= resultPersent && resultPersent < 40){
            resultArr.push(2);
        }else if(40 <= resultPersent && resultPersent < 60){
            resultArr.push(3);
        }else if(60 <= resultPersent && resultPersent < 80){
            resultArr.push(4);
        }else{
            resultArr.push(5);
        }

        // 결과 priview show
        if(resultArr.length > 0){
            // priviewDiv.forEach(() => {

            // })
        }
        console.log(resultArr)
    }

    // 화살표 포지션 초기화, 재시작
    function reStartSlot(){
        roundCount = 1;
        persent = 0;
        resultPersent = 0;
        arrow.style.transform = `translateX(0px)`
        Arrdirection = 'right';
        moveArr();
        buttonAct = true;
    }
    </script>
</body>
</html>